services:
  rtmp:
    image: alfg/nginx-rtmp:latest
    restart: unless-stopped
    entrypoint: ["nginx"]
    command: ["-g", "daemon off;", "-c", "/etc/nginx/nginx.conf"]
    ports:
      - "1935:1935"  # OBS -> RTMP ingest
      - "8080:80"    # HLS + /stat
    volumes:
      - ./rtmp/nginx.conf:/etc/nginx/nginx.conf:ro
      - ./hls:/opt/data/hls

  backend:
    build:
      context: ./backend
    restart: unless-stopped
    ports:
      - "8000:8000"  # Web UI + API
    depends_on:
      - rtmp
