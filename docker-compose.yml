services:
  mediamtx:
    image: bluenviron/mediamtx:latest
    restart: unless-stopped
    # WebRTC is extremely sensitive to NAT and advertised IPs; host networking keeps
    # ICE candidates correct on a headless Ubuntu VM.
    network_mode: host
    volumes:
      - ./mediamtx/mediamtx.yml:/mediamtx.yml:ro

  backend:
    build:
      context: ./backend
    restart: unless-stopped
    network_mode: host
    environment:
      # OpenCV reads RTSP; MediaMTX serves RTSP on 8554 when enabled.
      RTSP_URL: rtsp://127.0.0.1:8554/live/stream
      DETECTOR_FPS: "10"
      DRAWS_PATH: /data/draws.json
    volumes:
      - ./data:/data
    depends_on:
      - mediamtx
