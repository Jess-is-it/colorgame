services:
  rtmp:
    image: alfg/nginx-rtmp:latest
    restart: unless-stopped
    ports:
      - "1935:1935"  # OBS -> RTMP ingest

  backend:
    build:
      context: ./backend
    restart: unless-stopped
    environment:
      GRR_DB_URL: "sqlite:////data/grr.db"
      # Inside the Compose network, the RTMP service name is 'rtmp'
      GRR_STREAM_URL: "rtmp://rtmp:1935/live/stream"
      GRR_SAMPLE_FPS_DEFAULT: "2"
    volumes:
      - ./data:/data
    ports:
      - "8000:8000"  # Web UI + API
    depends_on:
      - rtmp
