{% extends "base.html" %}
{% block content %}
<section class="card">
  <div class="row between">
    <h2>{{ "Edit" if preset else "New" }} Preset</h2>
    <a class="btn" href="/presets">Back</a>
  </div>

  <form method="post" action="/presets/save" class="form">
    {% if preset %}
      <input type="hidden" name="preset_id" value="{{ preset.id }}" />
    {% endif %}

    <label>Name</label>
    <input name="name" value="{{ preset.name if preset else '' }}" required />

    <div class="row">
      <div class="col">
        <label>Expected input width</label>
        <input name="input_width" type="number" min="1" value="{{ preset.input_width if preset else 1920 }}" required />
      </div>
      <div class="col">
        <label>Expected input height</label>
        <input name="input_height" type="number" min="1" value="{{ preset.input_height if preset else 1080 }}" required />
      </div>
    </div>

    <label>ROIs JSON</label>
    <textarea name="rois_json" rows="6" class="mono" spellcheck="false">{{ preset.rois | tojson if preset else '[]' }}</textarea>
    <div class="muted">Example: [{"x": 100, "y": 100, "w": 800, "h": 200, "name": "end_screen"}]</div>

    <label>Keywords (comma-separated)</label>
    <input name="keywords_csv" value="{{ (preset.keywords|join(', ')) if preset else '' }}" />

    <label>Confidence threshold (0..1)</label>
    <input name="confidence_threshold" type="number" min="0" max="1" step="0.05" value="{{ preset.confidence_threshold if preset else 0.7 }}" />

    <label>Optional score regex</label>
    <input name="score_regex" value="{{ preset.score_regex if preset and preset.score_regex else '' }}" placeholder="e.g. Score:\s*(?P<score>\\d+)" />

    <div class="row">
      <button class="btn primary" type="submit">Save</button>
      {% if preset %}
        <button class="btn danger" type="submit" formaction="/presets/{{ preset.id }}/delete" formmethod="post" onclick="return confirm('Delete this preset?');">Delete</button>
      {% endif %}
    </div>
  </form>
</section>
{% endblock %}
